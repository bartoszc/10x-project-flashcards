---
import Layout from "../../layouts/Layout.astro";
import { ResetPasswordForm } from "../../components/auth/ResetPasswordForm";

const supabase = Astro.locals.supabase;
const {
  data: { user },
} = await supabase.auth.getUser();

// Redirect to generate page if already logged in?
// Usually, even logged in users might want to reset password via this flow if they forgot it (though they should use profile settings).
// For now, let's allow it or we could redirect to profile.
// The spec says "Redirect to /login" for protected pages, but this is a public page.
// Let's keep it accessible even if logged in, or redirect to dashboard if that makes more sense.
// Standard practice: if logged in, maybe redirect to settings?
// But user might be confused. Let's redirect to generate if logged in, assuming they know their password or used a magic link.
if (user) {
  return Astro.redirect("/generate");
}
---

<Layout title="Odzyskaj hasło | 10x Cards">
  <main class="min-h-screen flex items-center justify-center bg-background px-4 py-12">
    <div class="w-full max-w-md space-y-8">
      <!-- Header -->
      <div class="text-center space-y-2">
        <h1 class="text-3xl font-bold tracking-tight">Odzyskaj hasło</h1>
        <p class="text-muted-foreground">
          Podaj adres email powiązany z Twoim kontem, a wyślemy Ci link do resetu hasła.
        </p>
      </div>

      <!-- Form Card -->
      <div class="bg-card border border-border rounded-lg p-6 shadow-sm space-y-6">
        <ResetPasswordForm client:load />

        <div class="text-center text-sm">
          <a href="/login" class="text-primary hover:underline underline-offset-4"> Wróć do logowania </a>
        </div>
      </div>
    </div>
  </main>
</Layout>
